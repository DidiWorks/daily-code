
//后续优化改进1；如果位置串了那么运行一次复位
              //2这个条件在

#SingLeInstance, Force  //确保脚本只有一个实例运行
#SetControlDelay, -1  //设置控制延迟
#SetMouseDelay, 20  //设置鼠标延迟
#SetWinDelay, 100 //设置窗口延迟
#SetBatchLines, 20ms //设置脚本执行速度，防止占用太CPU资源

CoordMode, Mouse, Screen  //设置鼠标坐标模式为屏幕
RunAsAdmin()  //以管理员最高权限运行

global RefreshInprogress := false//标记状态，检查刷新是否在进行
global ErrorCount := 0  //记录错误发生的次数
global MaxErrors := 3

SetTimer, WatchMouseClick, 100  //鼠标定时检测器

Refresh()//脚本打开直接运行刷新，脚本允许先调用后定义。
 
鼠标点击退出函数：
    如果没有在刷新
	 返回
	 检测鼠标左键状态
	 GetKeyState, LButton, LButton, P //这里这个P是检测鼠标的物理状态，如果没有这个那么会发生鼠标在刷新点击时候也会执行退出
	 if(LButton == "D"){
	 ExitApp}   //如果按下，那么退出
  返回	 
	 
刷新功能
{
	   开关状态：true
	   if（如果窗口没有检测到）{
		   那么启动iVMS-4200
	   }
	   
	    窗口模式2
		激活当前窗口
		等待10秒
		if !WinActive("iVMS-4200")  也就是不能启动
		{
			 报错信号++
			 if(错误>=最大值）{
			   在次启动
			   计数器清零 // 假如一直错误失败就一直启动，自我恢复机制
			 }
			 脚本暂停
			 返回
		}
		时间2秒
		
		退出全屏
		时间2秒
		
		定义每组操作的坐标
		
		Groups：=[] //1-12组
		...
		
		
		历遍每组操作
		每2组释放一次内存
		如果失败重新启动刷新
		完成脚本退出
		
}
    基础函数
	 SmoothMove(x, y, speed := 30)   //传值speed := 30
{
    MouseGetPos, currX, currY    //获取当前坐标存储到currX, currY
    stepX := (x - currX) / speed  //用目标点-当前点/speed 
    stepY := (y - currY) / speed
    Loop, %speed% {         //循环 speed 次
        currX += stepX      //自增
        currY += stepY 
        MouseMove, %currX%, %currY%, 0  //移动鼠标到新位置
        Sleep, 20
    }
    MouseMove, x, y, 0   //最后精确目标的点的值
} 




  
  # iVMS-4200 自动刷新脚本说明文档

## 一、项目背景
为了解决监控画面与现场不同步的问题，开发了此脚本实现自动刷新。

## 二、核心功能
- 模拟鼠标双击刷新监控画面
- 每组刷新坐标顺序执行
- 检测失败时自动重启程序
- 脚本自恢复机制防止死循环

## 三、使用说明
1. 以管理员权限运行
2. 保持 iVMS-4200 安装路径不变
3. 建议用计划任务或开机自启动方式运行

## 四、技术细节
- 使用 AHK 控制窗口激活、鼠标移动
- 引入 `SmoothMove()` 使鼠标移动更自然
- 错误计数机制防止程序僵死

## 五、已知问题与优化方向
- 鼠标位置串位可能导致误操作（待增加位置验证）
- 刷新后是否真正生效无法验证（可考虑图像识别）
- 可能增加日志输出机制用于排错

## 六、总结
  其实这个脚本的逻辑很简单，但实际过程中开发的很坎坷，主要是目标摄像头电脑的配置很低，
又要求需要长时间稳定运行，那么我在外部设置了任务计划程序.来定时重启，定时启动矫正复位.
总的来说是4个脚本用任务计划程序来控制每运行一个退出一个，时间点设置成不冲突，办法虽然简单
但是解决了这个问题.
  主刷新逻辑剩下都是配套3个重启复位，打开软件，这三个功能封装成3个用任务计划程序来控制
当时主要的问题是电脑总是死机卡死，而不是程序错误，然后我就把脚本拆开，用每天重启来解决的。


	      
	   
	   
